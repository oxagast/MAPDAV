TODO:
  - User specification of which shells to be considered valid.
  - Various bugfixes.
